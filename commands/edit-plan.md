编辑计划文件，支持多种模式。用于 work 之后返工修改计划。

## ⚠️ 重要限制

**此命令只能修改计划文件（`.factory/docs/plans/*.md`），绝对禁止修改任何代码文件！**

- ✅ 可以：修改计划文档、调整任务列表、更新技术方案
- ❌ 禁止：修改源代码、创建代码文件、编辑配置文件

## 参数说明

格式: `/edit-plan [ulw] [计划ID] [内容...]`

- `ulw`: 可选，启用深度思考模式
- 计划ID: 如 `P001`，可选
- 内容: 修改内容描述

**示例:**
- `/edit-plan` - 进入最新计划的编辑上下文
- `/edit-plan P001` - 进入 P001 计划的编辑上下文
- `/edit-plan ulw P001 重新设计方案` - 深度思考模式修改计划
- `/edit-plan 添加错误处理步骤` - 修改最新计划

## Instructions

### 1. 解析参数

检查是否包含 `ulw`（深度思考模式）：
- 如果第一个词是 `ulw` → 启用深度思考模式，启动 `deep-thinking-planner` 子代理
- 否则 → 普通模式，直接处理

### 2. 深度思考模式 (ulw)

启动 `deep-thinking-planner` 子 agent：

```
Task:
  subagent_type: deep-thinking-planner
  description: 深度思考修改计划
  prompt: |
    计划ID: [如有]
    修改需求: [内容]
    
    请深度分析并修改计划。注意：只修改计划文件，不要修改任何代码！
```

### 3. 普通模式

1. **定位计划文件**:
   - 在 `.factory/docs/plans/` 目录查找
   - 有计划ID → 查找 `<ID>-*.md`
   - 无计划ID → 使用最新的计划文件

2. **阅读当前计划**:
   - 读取计划文件内容
   - 理解当前的技术方案和任务列表

3. **修改计划** (有内容时):
   - **只修改 `.factory/docs/plans/` 下的计划文件**
   - 根据用户描述更新计划内容
   - 可以调整：任务列表、技术方案、验收标准、风险说明
   - 保存修改并告知用户

4. **进入编辑上下文** (无内容时):
   - 输出: "已打开计划 `<ID>: <标题>`，请告诉我需要修改的内容"
   - 等待用户后续指示

### 4. 执行修改

**直接执行修改，不需要询问用户确认。计划文档必须被更新。**

1. 根据分析结果直接修改计划文件
2. 修改完成后告知用户改了什么
3. 提示可以用 `/work` 重新实现

---

现在处理: $ARGUMENTS
