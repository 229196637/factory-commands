## 研究发现

### 证据表

| 发现 | 证据 |
|------|------|
| **会话搜索** | 搜索了 `C:\Users\unclefata\.factory\sessions` 中的多个会话，找到大量涉及日志分析的会话 |
| **问题模式** | 从会话 `81769fee` 中发现：用户粘贴JSON格式的错误日志，AI需要解析stack traceback并定位代码 |
| **关键问题** | 从会话 `e703b403` 中发现：AI无法直接访问 `E:\Tools\星火编辑器\logs\lua` 路径，需要用户手动提取日志内容 |
| **日志结构** | 日志文件位于 `E:\Tools\星火编辑器\logs\lua\`，格式为 `lua-editor-YYYY-MM-DD HH_MM_SS_mmm.log` 和 `lua-game-*.log` |
| **日志格式** | 日志包含时间戳、线程ID、级别、帧号、文件位置和内容，如 `[2026-01-12 17:40:18.938][26032][info][1][base/base/ip.lua:30]` |
| **用户需求** | 用户提到"第一次阅读可能不是最新的，需要阅读两次"——这是因为日志文件可能正在被写入 |

### 技能适用性评估
- **重复性**: 高 - 日志分析是开发过程中的常见任务
- **模式一致**: 是 - 日志格式固定，分析流程可标准化
- **跨会话**: 是 - 多个会话都涉及类似的日志分析工作

### 技能设计

**名称**: `spark-editor-log-analyzer`
**位置**: 个人技能目录 `C:\Users\unclefata\.factory\skills\spark-editor-log-analyzer\`

**技能内容**:

```markdown
---
name: spark-editor-log-analyzer
description: 分析星火编辑器Lua日志文件，排查错误和调试信息。当用户提到星火编辑器日志、lua日志、报错分析时使用。
---

# 星火编辑器日志分析

## 日志位置
- 路径: `E:\Tools\星火编辑器\logs\lua\`
- 编辑器日志: `lua-editor-*.log`
- 游戏日志: `lua-game-*.log`

## 分析流程

### 1. 读取日志（必须读取两次）
由于日志文件可能正在被写入，第一次读取可能不是最新内容：
1. 第一次读取：获取文件内容
2. 等待1秒或立即再次读取
3. 第二次读取：确保获取最新内容

### 2. 定位错误
搜索关键词：
- `[error]` - 错误级别日志
- `stack traceback` - Lua调用栈
- `attempt to` - 常见Lua错误
- `nil value` - 空值错误
- `bad argument` - 参数错误

### 3. 解析错误格式
日志格式: `[时间][线程ID][级别][帧号][文件:行号] 内容`
示例: `[2026-01-12 17:40:18.938][26032][error][1][base/base/ip.lua:30] 错误信息`

### 4. 分析调用栈
从 `stack traceback` 提取：
- 错误发生的文件和行号
- 调用链条（从下往上）
- 根本原因定位

### 5. 定位源代码
日志中的路径映射：
- `p_qaz1/client/` → `ui/script/client/`
- `p_qaz1/server/` → `script/server/`

## 输出格式
1. 错误摘要
2. 调用链分析
3. 根本原因
4. 修复方案（A/B/C选项）
```

**目录结构**:
```
spark-editor-log-analyzer/
├── SKILL.md          # 主技能文件
└── references.md     # 路径映射和常见错误模式参考
```

### 为什么不包含脚本
- 日志分析主要是阅读和理解，不需要自动化脚本
- AI可以直接使用Read工具读取日志文件
- 错误分析需要结合代码上下文，无法完全自动化

确认后我将创建这个技能。